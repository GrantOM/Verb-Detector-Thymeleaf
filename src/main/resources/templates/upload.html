<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <title>Bloom's Taxonomy Verb Detector</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    
    <!-- Homepage Specific Elements -->
    <link rel="stylesheet" href="styles/layout.css" type="text/css" />
	<script type="text/javascript" src="scripts/jquery-1.4.1.min.js"></script>
	<script type="text/javascript" src="scripts/jquery-ui-1.7.2.custom.min.js"></script>
	<script type="text/javascript" src="scripts/list-control.js"></script>
    <!-- <script type="application/javascript" src="scripts/pie_chart.js"></script>  -->
    <!--<script type="text/javascript" src="scripts/d3.min.js"></script>      -->
    <!--<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>   -->
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?2.4.6"></script>
    <script src='http://mbostock.github.com/d3/d3.layout.js?2.4.6' type='text/javascript'></script>
    <!-- End Homepage Specific Elements -->
</head>
<body>
	<div id="header">
		<h1>Bloom's Taxonomy Verb Detector</h1>
	</div>
   	<div class="colmask threecol">
		<div class="colmid">
			<div class="colleft">
				<div class="col1">
                    <!-- Column 1 start -->
                    <script>
                        function content_view_click(content, graph) {
                            document.getElementById(content).style.display = 'block';
                            document.getElementById(graph).style.display = 'none';
                        }

                        function graph_view_click(content, graph) {
                            document.getElementById(content).style.display = 'none';
                            document.getElementById(graph).style.display = 'block';
                        }

                    </script>
                    <button id="content-view" onclick="content_view_click('content', 'graphs')">Content</button>
                    <button id="graph-view" onclick="graph_view_click('content', 'graphs')">Graphs</button>
                    <div id = "content">
                        <!-- <p th:text="'Document name: ' + ${upload.id}" /> -->
                        <p th:text="${upload.content}" />
                    </div>
                    <div style="display:none"  id = "graphs" class="graphs">
						
						<div id="d3portfolio"></div>
						<script th:inline="javascript">
						/*<![CDATA[*/
						           
					  	var total = /*[[${upload.totalVal}]]*/ '0';
						var creating = /*[[${upload.creatingVal}]]*/ '0';
						var evaluating = /*[[${upload.evaluatingVal}]]*/ '0';
						var analysing = /*[[${upload.analysingVal}]]*/ '0';
						var applying = /*[[${upload.applyingVal}]]*/ '0';
						var understanding = /*[[${upload.understandingVal}]]*/ '0';
						var remembering = /*[[${upload.rememberingVal}]]*/ '0';        
						           
						var agg = { label: 'Bloom\'s Taxonomy', pct: [remembering,understanding,analysing,applying,evaluating,creating] },
						
					    data = agg;
						
						var labels = ['Remembering', 'Understanding', 'Analysing', 'Applying', 'Evaluating', 'Creating'];
						
						var w = 320,                       // width and height, natch
						    h = 320,
						    r = Math.min(w, h) / 2,        // arc radius
						    dur = 750,                     // duration, in milliseconds
						    color = d3.scale.category10(),
						    donut = d3.layout.pie().sort(null),
						    arc = d3.svg.arc().innerRadius(r - 80).outerRadius(r - 20);
						
						// ---------------------------------------------------------------------
						var svg = d3.select("#d3portfolio").append("svg:svg")
						    .attr("width", w).attr("height", h);
						
						var arc_grp = svg.append("svg:g")
						    .attr("class", "arcGrp")
						    .attr("transform", "translate(" + (w / 2) + "," + (h / 2) + ")");
						
						var label_group = svg.append("svg:g")
						    .attr("class", "lblGroup")
						    .attr("transform", "translate(" + (w / 2) + "," + (h / 2) + ")");
						
						// GROUP FOR CENTER TEXT
						var center_group = svg.append("svg:g")
						    .attr("class", "ctrGroup")
						    .attr("transform", "translate(" + (w / 2) + "," + (h / 2) + ")");
						
						// CENTER LABEL
						var pieLabel = center_group.append("svg:text")
						    .attr("dy", ".35em").attr("class", "chartLabel")
						    .attr("text-anchor", "middle")
						    .text(data.label);
						
						// DRAW ARC PATHS
						var arcs = arc_grp.selectAll("path")
						    .data(donut(data.pct));
						arcs.enter().append("svg:path")
						    .attr("stroke", "white")
						    .attr("stroke-width", 0.5)
						    .attr("fill", function(d, i) {return color(i);})
						    .attr("d", arc)
						    .each(function(d) {this._current = d});
						
						// DRAW SLICE LABELS
						var sliceLabel = label_group.selectAll("text")
						    .data(donut(data.pct));
						sliceLabel.enter().append("svg:text")
						    .attr("class", "arcLabel")
						    .attr("transform", function(d) {return "translate(" + arc.centroid(d) + ")"; })
						    .attr("text-anchor", "middle")
						    .text(function(d, i) {return labels[i]; });
						
						// --------- "PAY NO ATTENTION TO THE MAN BEHIND THE CURTAIN" ---------
						
						// Store the currently-displayed angles in this._current.
						// Then, interpolate from this._current to the new angles.
						function arcTween(a) {
						    var i = d3.interpolate(this._current, a);
						    this._current = i(0);
						    return function(t) {
						        return arc(i(t));
						    };
						}
						
						// update chart
						function updateChart(model) {
						    data = eval(model); // which model?
						
						    arcs.data(donut(data.pct)); // recompute angles, rebind data
						    arcs.transition().ease("elastic").duration(dur).attrTween("d", arcTween);
						
						    sliceLabel.data(donut(data.pct));
						    sliceLabel.transition().ease("elastic").duration(dur)
						        .attr("transform", function(d) {return "translate(" + arc.centroid(d) + ")"; })
						        .style("fill-opacity", function(d) {return d.value==0 ? 1e-6 : 1;});
						        
						    pieLabel.text(data.label);
						}
						
						// click handler
						$("#objectives a").click(function() {
						    updateChart(this.href.slice(this.href.indexOf('#') + 1));
						});
						/*]]>*/
						</script>
                    </div>
					<!-- Column 1 end -->
				</div>
				<div class="col2">
					<!-- Column 2 start -->
                    <form action="#" th:action="@{/upload}" th:object="${upload}" method="post" enctype="multipart/form-data">
                        <p>Name: <input type="text" th:field="*{id}" /></p>
                        File 1: <input type="file" name="file"/><br />
                        <!--File 2: <input type="file" name="file2"/><br />-->
                        <!--<p>Message: <input type="text" th:field="*{content}" /></p>-->
                        <p><input type="submit" value="Submit" /></p>
                        <a href="/upload">Upload another file</a>
                    </form>
					<!-- Column 2 end -->
				</div>
				<div class="col3">
					<!-- Column 3 start -->
					<div id="listContainer">
			            <div class="listControl">
			                <a id="expandList">Expand All</a>
			                <!-- code for the collapse list button - commented out as it causes problems 
			                with the total count in paraenthesies for each category-->
			               	<!-- <a id="collapseList">Collapse All</a> -->
			            </div>
			            <ul id="expList">
			                <li>
			                    Creating (<span id="total" th:text="${upload.creatingVal} "></span>)
			                    <ul>
			                        <li>
			                           <p th:text="${upload.creating}" />
			                        </li>
			                    </ul>
			                </li>
			                <li>
			                    Evaluating (<span th:text="${upload.evaluatingVal} "></span>)
			                    <ul>
			                    	<li>
			                    		<p th:text="${upload.evaluating}" />
			                    	</li>
			                    </ul>
			                </li>
			                <li>
			                    Analysing (<span th:text="${upload.analysingVal} "></span>)
			                    <ul>
			                        <li>
			                            <p th:text="${upload.analysing}" />
			                        </li>
			                    </ul>
			                </li>
			                <li>
			                    Applying (<span th:text="${upload.applyingVal} "></span>)
			                    <ul>
			                        <li>
			                            <p th:text="${upload.applying}" />
			                        </li>
			                    </ul>
			                </li>
			                <li>
			                    Understanding (<span th:text="${upload.understandingVal} "></span>)
			                    <ul>
			                        <li>
			                            <p th:text="${upload.understanding}" />
			                        </li>
			                    </ul>
			                </li>
			                <li>
			                    Remembering (<span th:text="${upload.rememberingVal} "></span>)
			                    <ul>
			                        <li>
			                            <p th:text="${upload.remembering}" />
			                        </li>
			                    </ul>
			                </li>
			            </ul>
			        </div>
					<!-- Column 3 end -->
				</div>
			</div>
		</div>
	</div>
</body>
</html>
